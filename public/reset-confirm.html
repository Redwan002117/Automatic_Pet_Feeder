<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Set New Password - Automatic Pet Feeder</title>
    <meta name="description" content="Set a new password for your Automatic Pet Feeder account.">
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="stylesheet" href="/styles/auth.css">
    <link rel="stylesheet" href="/styles/toast.css">
    <link rel="stylesheet" href="/styles/ios.css">
    <link rel="stylesheet" href="/styles/ios-animations.css">
    <link rel="stylesheet" href="/styles/captcha.css">
    <link rel="icon" href="/assets/images/logo.svg" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="/scripts/component-loader.js"></script>
</head>
<body class="ios-ui" data-title="Set New Password">
    <!-- Loading Overlay Component -->
    <div data-component="loading-overlay"></div>
    <header class="site-header ios-header">
        <div class="container header-container">
            <div class="logo">
                <a href="index.html">
                    <img src="/assets/images/logo.svg" alt="Pet Feeder Logo">
                    <span>PetFeeder</span>
                </a>
            </div>
        </div>
    </header>

    <main class="auth-container ios-container">
        <div class="auth-card ios-card">
            <div class="auth-header ios-card-header">
                <img src="/assets/images/logo.svg" alt="Pet Feeder Logo" class="auth-logo">
                <h1 class="auth-title ios-title">Set New Password</h1>
                <p class="auth-subtitle ios-subtitle">Create a new password for your account</p>
            </div>

            <div class="auth-content">
                <form id="reset-confirm-form" class="auth-form ios-form active">
                    <div class="auth-form-group ios-form-group">
                        <label for="password" class="auth-form-label ios-form-label">New Password</label>
                        <div class="auth-form-control ios-form-control">
                            <input type="password" id="password" name="password" required autocomplete="new-password" placeholder="Enter your new password" class="auth-form-input ios-form-input has-icon">
                            <button type="button" class="auth-form-icon password-toggle ios-button-icon" aria-label="Toggle password visibility">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="auth-form-group ios-form-group">
                        <label for="confirm-password" class="auth-form-label ios-form-label">Confirm New Password</label>
                        <div class="auth-form-control ios-form-control">
                            <input type="password" id="confirm-password" name="confirm-password" required autocomplete="new-password" placeholder="Confirm your new password" class="auth-form-input ios-form-input has-icon">
                            <button type="button" class="auth-form-icon password-toggle ios-button-icon" aria-label="Toggle password visibility">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="auth-error ios-alert" id="reset-confirm-error"></div>
                    <div class="auth-success ios-success" id="reset-confirm-success"></div>
                    <div id="reset-confirm-captcha-container" class="captcha-container ios-captcha-container"></div>
                    <button type="submit" class="auth-submit ios-button ios-button-primary" data-original-text="Set New Password">Set New Password</button>
                </form>
            </div>

            <div class="auth-footer ios-card-footer">
                <p class="auth-footer-text">Remember your password? <a href="login.html" class="auth-footer-link ios-link">Back to Login</a></p>
            </div>
        </div>
    </main>

    <footer class="site-footer auth-footer ios-footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2023 PetFeeder. All rights reserved.</p>
                <div class="footer-links">
                    <a href="#" class="ios-link">Privacy Policy</a>
                    <a href="#" class="ios-link">Terms of Service</a>
                    <a href="#" class="ios-link">Support</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="/scripts/config.js"></script>
    <script src="/scripts/utils.js"></script>
    <script src="/scripts/main.js"></script>
    <script src="/scripts/auth.js"></script>
    <script src="/scripts/captcha-protection.js"></script>
    
    <!-- Token extraction script for cPanel compatibility -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Extract hash parameters from URL
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);
            
            // Get the access token and type from hash parameters