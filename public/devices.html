<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Devices - Automatic Pet Feeder</title>
    <meta name="description" content="Manage your pet feeder devices and monitor their status.">
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="stylesheet" href="/styles/dashboard.css">
    <link rel="stylesheet" href="/styles/devices.css">
    <link rel="stylesheet" href="/styles/toast.css">
    <link rel="stylesheet" href="/styles/ios.css">
    <link rel="stylesheet" href="/styles/ios-animations.css">
    <link rel="icon" href="/assets/images/logo.svg" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="/scripts/component-loader.js"></script>
</head>
<body class="ios-ui" data-title="My Devices">
    <!-- Loading Overlay Component -->
    <div data-component="loading-overlay"></div>

    <div class="dashboard-container ios-dashboard">
        <!-- Sidebar Navigation -->
        <aside class="sidebar ios-sidebar">
            <div data-component="sidebar"></div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content ios-main-content">
            <!-- Header Component -->
            <header class="content-header ios-header ios-animated-header">
                <div data-component="header" data-title="My Devices"></div>
            </header>

            <div class="content-body ios-content-body">
                <section class="devices-actions ios-action-bar">
                    <button class="ios-button ios-button-primary" id="add-device-btn">
                        <i class="fas fa-plus"></i> Add New Device
                    </button>
                    <div class="devices-filter ios-filter">
                        <label for="device-status-filter">Filter:</label>
                        <select id="device-status-filter" class="ios-form-input">
                            <option value="all">All Devices</option>
                            <option value="online">Online Only</option>
                            <option value="offline">Offline Only</option>
                        </select>
                    </div>
                </section>

                <!-- Devices Grid -->
                <section class="devices-grid ios-grid" id="devices-container">
                    <!-- Device Card -->
                    <div class="device-card ios-card" data-device-id="1" data-device-status="online">
                        <div class="device-card-header ios-card-header">
                            <h3 class="device-name">Living Room Feeder</h3>
                            <span class="device-status online">Online</span>
                            <div class="device-menu">
                                <button class="ios-button-icon" aria-label="Device menu">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <div class="device-menu-dropdown">
                                    <a href="#" class="edit-device" data-device-id="1">Edit Device</a>
                                    <a href="#" class="view-device-details" data-device-id="1">View Details</a>
                                    <a href="#" class="restart-device" data-device-id="1">Restart Device</a>
                                    <a href="#" class="remove-device" data-device-id="1">Remove Device</a>
                                </div>
                            </div>
                        </div>
                        <div class="device-body ios-card-body">
                            <div class="device-info">
                                <div class="device-info-item">
                                    <span class="info-label">Model:</span>
                                    <span class="info-value">PetFeeder Pro</span>
                                </div>
                                <div class="device-info-item">
                                    <span class="info-label">Serial:</span>
                                    <span class="info-value">PFP1001203</span>
                                </div>
                                <div class="device-info-item">
                                    <span class="info-label">Last Active:</span>
                                    <span class="info-value">Just now</span>
                                </div>
                            </div>
                            <div class="device-stats">
                                <div class="device-stat">
                                    <span class="stat-label">Food Level:</span>
                                    <div class="progress-bar ios-progress-bar">
                                        <div class="progress-fill" style="width: 72%"></div>
                                    </div>
                                    <span class="stat-value">72%</span>
                                </div>
                                <div class="device-stat">
                                    <span class="stat-label">Battery:</span>
                                    <div class="progress-bar ios-progress-bar">
                                        <div class="progress-fill" style="width: 85%"></div>
                                    </div>
                                    <span class="stat-value">85%</span>
                                </div>
                            </div>
                            <div class="device-actions">
                                <button class="ios-button ios-button-primary feed-now-btn" data-device-id="1">Feed Now</button>
                                <a href="/schedules.html?device=1" class="ios-button ios-button-outline">Schedule</a>
                                <a href="#" class="ios-button ios-button-outline view-device-details" data-device-id="1">Details</a>
                            </div>
                        </div>
                    </div>

                    <!-- Device Card -->
                    <div class="device-card ios-card" data-device-id="2" data-device-status="online">
                        <div class="device-card-header ios-card-header">
                            <h3 class="device-name">Kitchen Feeder</h3>
                            <span class="device-status online">Online</span>
                            <div class="device-menu">
                                <button class="ios-button-icon" aria-label="Device menu">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <div class="device-menu-dropdown">
                                    <a href="#" class="edit-device" data-device-id="2">Edit Device</a>
                                    <a href="#" class="view-device-details" data-device-id="2">View Details</a>
                                    <a href="#" class="restart-device" data-device-id="2">Restart Device</a>
                                    <a href="#" class="remove-device" data-device-id="2">Remove Device</a>
                                </div>
                            </div>
                        </div>
                        <div class="device-body ios-card-body">
                            <div class="device-info">
                                <div class="device-info-item">
                                    <span class="info-label">Model:</span>
                                    <span class="info-value">PetFeeder Standard</span>
                                </div>
                                <div class="device-info-item">
                                    <span class="info-label">Serial:</span>
                                    <span class="info-value">PFS2005109</span>
                                </div>
                                <div class="device-info-item">
                                    <span class="info-label">Last Active:</span>
                                    <span class="info-value">2 minutes ago</span>
                                </div>
                            </div>
                            <div class="device-stats">
                                <div class="device-stat">
                                    <span class="stat-label">Food Level:</span>
                                    <div class="progress-bar ios-progress-bar warning">
                                        <div class="progress-fill" style="width: 15%"></div>
                                    </div>
                                    <span class="stat-value warning">15% (Low)</span>
                                </div>
                                <div class="device-stat">
                                    <span class="stat-label">Battery:</span>
                                    <div class="progress-bar ios-progress-bar">
                                        <div class="progress-fill" style="width: 62%"></div>
                                    </div>
                                    <span class="stat-value">62%</span>
                                </div>
                            </div>
                            <div class="device-actions">
                                <button class="ios-button ios-button-primary feed-now-btn" data-device-id="2">Feed Now</button>
                                <a href="/schedules.html?device=2" class="ios-button ios-button-outline">Schedule</a>
                                <a href="#" class="ios-button ios-button-outline view-device-details" data-device-id="2">Details</a>
                            </div>
                        </div>
                    </div>

                    <!-- Device Card -->
                    <div class="device-card ios-card" data-device-id="3" data-device-status="offline">
                        <div class="device-card-header ios-card-header">
                            <h3 class="device-name">Bedroom Feeder</h3>
                            <span class="device-status offline">Offline</span>
                            <div class="device-menu">
                                <button class="ios-button-icon" aria-label="Device menu">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <div class="device-menu-dropdown">
                                    <a href="#" class="edit-device" data-device-id="3">Edit Device</a>
                                    <a href="#" class="view-device-details" data-device-id="3">View Details</a>
                                    <a href="#" class="remove-device" data-device-id="3">Remove Device</a>
                                </div>
                            </div>
                        </div>
                        <div class="device-body ios-card-body">
                            <div class="device-info">
                                <div class="device-info-item">
                                    <span class="info-label">Model:</span>
                                    <span class="info-value">PetFeeder Mini</span>
                                </div>
                                <div class="device-info-item">
                                    <span class="info-label">Serial:</span>
                                    <span class="info-value">PFM3002098</span>
                                </div>
                                <div class="device-info-item">
                                    <span class="info-label">Last Active:</span>
                                    <span class="info-value">2 days ago</span>
                                </div>
                            </div>
                            <div class="device-offline-message">
                                <i class="fas fa-exclamation-triangle"></i>
                                <p>This device appears to be offline. Check power and Wi-Fi connection.</p>
                            </div>
                            <div class="device-actions">
                                <button class="ios-button ios-button-primary feed-now-btn" disabled>Feed Now</button>
                                <button class="ios-button ios-button-outline troubleshoot-btn" data-device-id="3">Troubleshoot</button>
                                <a href="#" class="ios-button ios-button-outline view-device-details" data-device-id="3">Details</a>
                            </div>
                        </div>
                    </div>

                    <!-- Add Device Card -->
                    <div class="device-card add-device-card ios-card" id="add-device-card">
                        <div class="add-device-content">
                            <div class="add-device-icon">
                                <i class="fas fa-plus-circle"></i>
                            </div>
                            <h3>Add New Device</h3>
                            <p>Connect a new PetFeeder device to your account</p>
                            <button class="ios-button ios-button-primary" id="add-device-card-btn">Add Device</button>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Add/Edit Device Modal -->
    <div class="modal ios-modal" id="device-modal">
        <div class="modal-content ios-modal-content">
            <div class="modal-header ios-modal-header">
                <h2 id="device-modal-title" class="ios-modal-title">Add New Device</h2>
                <button class="modal-close ios-button-icon" aria-label="Close modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body ios-modal-body">
                <form id="device-form" class="ios-form">
                    <input type="hidden" id="device-id" name="device-id" value="">
                    
                    <div class="form-group ios-form-group">
                        <label for="device-name" class="ios-form-label">Device Name</label>
                        <input type="text" id="device-name" name="device-name" class="ios-form-input" placeholder="e.g. Living Room Feeder" required>
                    </div>
                    
                    <div class="form-group ios-form-group">
                        <label for="device-model" class="ios-form-label">Device Model</label>
                        <select id="device-model" name="device-model" class="ios-form-input" required>
                            <option value="">Select Model</option>
                            <option value="pro">PetFeeder Pro</option>
                            <option value="standard">PetFeeder Standard</option>
                            <option value="mini">PetFeeder Mini</option>
                        </select>
                    </div>
                    
                    <div class="form-group ios-form-group">
                        <label for="device-serial" class="ios-form-label">Serial Number</label>
                        <input type="text" id="device-serial" name="device-serial" class="ios-form-input" placeholder="Found on the bottom of your device" required>
                    </div>
                    
                    <div class="form-group ios-form-group">
                        <label for="connection-type" class="ios-form-label">Connection Type</label>
                        <select id="connection-type" name="connection-type" class="ios-form-input" required>
                            <option value="">Select Connection Type</option>
                            <option value="wifi">Wi-Fi</option>
                            <option value="bluetooth">Bluetooth</option>
                            <option value="ethernet">Ethernet</option>
                        </select>
                    </div>
                    
                    <div class="form-group ios-form-group">
                        <label for="wifi-network" class="ios-form-label wifi-network-label">Wi-Fi Network</label>
                        <select id="wifi-network" name="wifi-network" class="ios-form-input">
                            <option value="">Select Wi-Fi Network</option>
                            <option value="home-network">Home Network</option>
                            <option value="office-network">Office Network</option>
                            <option value="other">Other Network</option>
                        </select>
                    </div>
                    
                    <div class="form-group ios-form-group wifi-password-group" style="display: none;">
                        <label for="wifi-password" class="ios-form-label">Wi-Fi Password</label>
                        <input type="password" id="wifi-password" name="wifi-password" class="ios-form-input" placeholder="Enter Wi-Fi password">
                    </div>
                    
                    <div class="form-group ios-form-group">
                        <label for="default-portion" class="ios-form-label">Default Portion Size (grams)</label>
                        <input type="number" id="default-portion" name="default-portion" class="ios-form-input" min="5" max="200" value="30">
                    </div>
                    
                    <div class="form-actions ios-form-actions">
                        <button type="button" class="ios-button ios-button-outline" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="ios-button ios-button-primary">Save Device</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Device Details Modal -->
    <div class="modal ios-modal" id="device-details-modal">
        <div class="modal-content modal-lg ios-modal-content">
            <div class="modal-header ios-modal-header">
                <h2 id="device-details-name" class="ios-modal-title">Device Details</h2>
                <button class="modal-close ios-button-icon" aria-label="Close modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body ios-modal-body">
                <div class="device-details-container ios-details-container">
                    <div class="device-details-header ios-details-header">
                        <div class="device-details-status">
                            <span class="device-details-status-indicator online"></span>
                            <span class="device-details-status-text">Online</span>
                        </div>
                        <div class="device-details-actions">
                            <button class="ios-button ios-button-primary feed-now-btn" data-device-id="1">Feed Now</button>
                            <button class="ios-button ios-button-outline edit-device" data-device-id="1">Edit Device</button>
                        </div>
                    </div>
                    
                    <div class="device-details-tabs ios-tabs">
                        <button class="tab-button active" data-tab="info">Device Info</button>
                        <button class="tab-button" data-tab="feeding">Feeding History</button>
                        <button class="tab-button" data-tab="settings">Settings</button>
                        <button class="tab-button" data-tab="troubleshoot">Troubleshooting</button>
                    </div>
                    
                    <div class="device-details-content ios-details-content">
                        <!-- Info Tab Content -->
                        <div id="info-tab" class="tab-content active">
                            <div class="device-info-grid">
                                <div class="device-info-section">
                                    <h3>Device Information</h3>
                                    <div class="device-info-list">
                                        <div class="device-info-item">
                                            <span class="info-label">Model:</span>
                                            <span class="info-value" id="details-model">PetFeeder Pro</span>
                                        </div>
                                        <div class="device-info-item">
                                            <span class="info-label">Serial Number:</span>
                                            <span class="info-value" id="details-serial">PFP1001203</span>
                                        </div>
                                        <div class="device-info-item">
                                            <span class="info-label">Firmware Version:</span>
                                            <span class="info-value" id="details-firmware">v2.1.5</span>
                                        </div>
                                        <div class="device-info-item">
                                            <span class="info-label">Last Updated:</span>
                                            <span class="info-value" id="details-last-update">2023-04-01</span>
                                        </div>
                                        <div class="device-info-item">
                                            <span class="info-label">Date Added:</span>
                                            <span class="info-value" id="details-date-added">2023-01-15</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="device-info-section">
                                    <h3>Status</h3>
                                    <div class="device-info-list">
                                        <div class="device-info-item">
                                            <span class="info-label">Status:</span>
                                            <span class="info-value" id="details-status">Online</span>
                                        </div>
                                        <div class="device-info-item">
                                            <span class="info-label">Last Feeding:</span>
                                            <span class="info-value" id="details-last-feeding">Today, 12:00 PM</span>
                                        </div>
                                        <div class="device-info-item">
                                            <span class="info-label">Next Scheduled:</span>
                                            <span class="info-value" id="details-next-feeding">Today, 8:00 PM</span>
                                        </div>
                                        <div class="device-info-item">
                                            <span class="info-label">Food Level:</span>
                                            <span class="info-value" id="details-food-level">72%</span>
                                        </div>
                                        <div class="device-info-item">
                                            <span class="info-label">Battery:</span>
                                            <span class="info-value" id="details-battery">85%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="device-info-section">
                                    <h3>Connection</h3>
                                    <div class="device-info-list">
                                        <div class="device-info-item">
                                            <span class="info-label">Connection Type:</span>
                                            <span class="info-value" id="details-connection-type">Wi-Fi</span>
                                        </div>
                                        <div class="device-info-item">
                                            <span class="info-label">Network:</span>
                                            <span class="info-value" id="details-network">Home-Network</span>
                                        </div>
                                        <div class="device-info-item">
                                            <span class="info-label">IP Address:</span>
                                            <span class="info-value" id="details-ip">192.168.1.105</span>
                                        </div>
                                        <div class="device-info-item">
                                            <span class="info-label">Signal Strength:</span>
                                            <span class="info-value" id="details-signal">Good (85%)</span>
                                        </div>
                                        <div class="device-info-item">
                                            <span class="info-label">Last Activity:</span>
                                            <span class="info-value" id="details-last-activity">Just now</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Feeding History Tab Content -->
                        <div id="feeding-tab" class="tab-content">
                            <div class="feeding-history-container">
                                <div class="feeding-history-header">
                                    <h3>Recent Feeding History</h3>
                                    <a href="/history.html?device=1" class="ios-button ios-button-text">View All History</a>
                                </div>
                                
                                <div class="feeding-history-chart-container">
                                    <canvas id="feeding-history-chart"></canvas>
                                </div>
                                
                                <div class="feeding-history-table">
                                    <table class="ios-table">
                                        <thead>
                                            <tr>
                                                <th>Date & Time</th>
                                                <th>Pet</th>
                                                <th>Amount</th>
                                                <th>Type</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Today, 12:00 PM</td>
                                                <td>Buddy</td>
                                                <td>80g</td>
                                                <td>Scheduled</td>
                                                <td><span class="status-badge success">Success</span></td>
                                            </tr>
                                            <tr>
                                                <td>Today, 8:00 AM</td>
                                                <td>Buddy</td>
                                                <td>80g</td>
                                                <td>Scheduled</td>
                                                <td><span class="status-badge success">Success</span></td>
                                            </tr>
                                            <tr>
                                                <td>Yesterday, 8:00 PM</td>
                                                <td>Buddy</td>
                                                <td>80g</td>
                                                <td>Scheduled</td>
                                                <td><span class="status-badge success">Success</span></td>
                                            </tr>
                                            <tr>
                                                <td>Yesterday, 12:00 PM</td>
                                                <td>Buddy</td>
                                                <td>80g</td>
                                                <td>Scheduled</td>
                                                <td><span class="status-badge success">Success</span></td>
                                            </tr>
                                            <tr>
                                                <td>Yesterday, 8:00 AM</td>
                                                <td>Buddy</td>
                                                <td>80g</td>
                                                <td>Scheduled</td>
                                                <td><span class="status-badge success">Success</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Settings Tab Content -->
                        <div id="settings-tab" class="tab-content">
                            <div class="device-settings-container">
                                <form id="device-settings-form" class="ios-form">
                                    <div class="form-group ios-form-group">
                                        <label for="settings-default-portion" class="ios-form-label">Default Portion Size (grams)</label>
                                        <input type="number" id="settings-default-portion" name="settings-default-portion" class="ios-form-input" min="5" max="200" value="80">
                                    </div>
                                    
                                    <div class="form-group ios-form-group">
                                        <label for="settings-default-pet" class="ios-form-label">Default Pet</label>
                                        <select id="settings-default-pet" name="settings-default-pet" class="ios-form-input">
                                            <option value="1">Buddy (Dog)</option>
                                            <option value="2">Max (Cat)</option>
                                            <option value="3">Luna (Cat)</option>
                                            <option value="none">No Default</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group ios-form-group">
                                        <label class="ios-form-label">Notifications</label>
                                        <div class="ios-checkbox-group">
                                            <label class="ios-checkbox">
                                                <input type="checkbox" id="settings-notify-success" name="settings-notify-success" checked>
                                                <span>Successful Feedings</span>
                                            </label>
                                            <label class="ios-checkbox">
                                                <input type="checkbox" id="settings-notify-failure" name="settings-notify-failure" checked>
                                                <span>Failed Feedings</span>
                                            </label>
                                            <label class="ios-checkbox">
                                                <input type="checkbox" id="settings-notify-low-food" name="settings-notify-low-food" checked>
                                                <span>Low Food Level (below 20%)</span>
                                            </label>
                                            <label class="ios-checkbox">
                                                <input type="checkbox" id="settings-notify-offline" name="settings-notify-offline" checked>
                                                <span>Device Offline</span>
                                            </label>
                                            <label class="ios-checkbox">
                                                <input type="checkbox" id="settings-notify-battery" name="settings-notify-battery" checked>
                                                <span>Low Battery (below 15%)</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group ios-form-group">
                                        <label class="ios-form-label">Device Options</label>
                                        <div class="ios-checkbox-group">
                                            <label class="ios-checkbox">
                                                <input type="checkbox" id="settings-sound" name="settings-sound" checked>
                                                <span>Play Sound When Dispensing Food</span>
                                            </label>
                                            <label class="ios-checkbox">
                                                <input type="checkbox" id="settings-scheduled-only" name="settings-scheduled-only">
                                                <span>Only Dispense During Scheduled Times</span>
                                            </label>
                                            <label class="ios-checkbox">
                                                <input type="checkbox" id="settings-child-lock" name="settings-child-lock">
                                                <span>Enable Child Lock (Prevents Manual Dispensing)</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group ios-form-group">
                                        <label for="settings-time-zone" class="ios-form-label">Device Time Zone</label>
                                        <select id="settings-time-zone" name="settings-time-zone" class="ios-form-input">
                                            <option value="America/New_York">Eastern Time (US & Canada)</option>
                                            <option value="America/Chicago">Central Time (US & Canada)</option>
                                            <option value="America/Denver">Mountain Time (US & Canada)</option>
                                            <option value="America/Los_Angeles">Pacific Time (US & Canada)</option>
                                            <option value="Europe/London">London</option>
                                            <option value="Europe/Paris">Paris</option>
                                            <option value="Asia/Tokyo">Tokyo</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-actions ios-form-actions">
                                        <button type="button" class="ios-button ios-button-outline" id="settings-reset-default">Reset to Default</button>
                                        <button type="submit" class="ios-button ios-button-primary">Save Settings</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Troubleshooting Tab Content -->
                        <div id="troubleshoot-tab" class="tab-content">
                            <div class="troubleshoot-container">
                                <div class="troubleshoot-section">
                                    <h3>Device Diagnostics</h3>
                                    <div class="diagnostic-buttons">
                                        <button class="ios-button ios-button-outline" id="run-diagnostics">Run Diagnostics</button>
                                        <button class="ios-button ios-button-outline" id="reset-device">Reset Device</button>
                                        <button class="ios-button ios-button-outline" id="update-firmware">Check for Updates</button>
                                    </div>
                                    <div class="diagnostic-results" id="diagnostic-results" style="display: none;">
                                        <h4>Diagnostic Results:</h4>
                                        <ul class="diagnostic-list">
                                            <li class="success">✓ Motor: Working properly</li>
                                            <li class="success">✓ Food Sensor: Working properly</li>
                                            <li class="success">✓ Wi-Fi Connection: Strong</li>
                                            <li class="warning">⚠ Battery: Discharging faster than expected</li>
                                            <li class="success">✓ Firmware: Up to date</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="troubleshoot-section">
                                    <h3>Common Issues</h3>
                                    <div class="accordion ios-accordion">
                                        <div class="accordion-item">
                                            <div class="accordion-header">
                                                <h4>Device Won't Connect to Wi-Fi</h4>
                                                <i class="fas fa-chevron-down"></i>
                                            </div>
                                            <div class="accordion-content">
                                                <p>Try these steps to resolve Wi-Fi connection issues:</p>
                                                <ol>
                                                    <li>Ensure your Wi-Fi router is turned on and working.</li>
                                                    <li>Check that the device is within range of your Wi-Fi signal.</li>
                                                    <li>Restart the device by unplugging it for 10 seconds, then plugging it back in.</li>
                                                    <li>Press and hold the reset button for 5 seconds to reset the Wi-Fi connection.</li>
                                                    <li>Try connecting to a 2.4GHz network instead of 5GHz (the device only supports 2.4GHz).</li>
                                                </ol>
                                            </div>
                                        </div>
                                        
                                        <div class="accordion-item">
                                            <div class="accordion-header">
                                                <h4>Food Not Dispensing</h4>
                                                <i class="fas fa-chevron-down"></i>
                                            </div>
                                            <div class="accordion-content">
                                                <p>If food is not dispensing properly, check the following:</p>
                                                <ol>
                                                    <li>Ensure the food container is properly attached and has food in it.</li>
                                                    <li>Check that the food is not too large for the dispenser (should be dry kibble size).</li>
                                                    <li>Look for any blockages in the dispensing mechanism.</li>
                                                    <li>Try a manual dispensing test to see if the motor is working.</li>
                                                    <li>Ensure the device has power (plugged in or has sufficient battery).</li>
                                                </ol>
                                            </div>
                                        </div>
                                        
                                        <div class="accordion-item">
                                            <div class="accordion-header">
                                                <h4>Device Shows Offline But Is Powered On</h4>
                                                <i class="fas fa-chevron-down"></i>
                                            </div>
                                            <div class="accordion-content">
                                                <p>If your device appears offline in the app but is powered on:</p>
                                                <ol>
                                                    <li>Check your internet connection on your phone and home network.</li>
                                                    <li>Restart the device by unplugging it for 10 seconds, then plugging it back in.</li>
                                                    <li>Force close and reopen the app.</li>
                                                    <li>Try logging out and back into the app.</li>
                                                    <li>Check if your router has blocked the device (some routers have security features that might block IoT devices).</li>
                                                </ol>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="troubleshoot-section">
                                    <h3>Contact Support</h3>
                                    <p>If you've tried troubleshooting steps and still having issues, our support team is here to help.</p>
                                    <div class="support-options">
                                        <button class="ios-button ios-button-outline" id="contact-support">
                                            <i class="fas fa-headset"></i> Contact Support
                                        </button>
                                        <a href="#" class="ios-button ios-button-outline">
                                            <i class="fas fa-book"></i> View Manual
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <!-- 1. First load Supabase library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        window.supabaseJs = supabase;
        window.supabase = null; // Reset for our own initialization
    </script>
    
    <!-- 2. Load Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- 3. Next load configuration -->
    <script src="/scripts/config.js"></script>
    
    <!-- 4. Then load main utilities -->
    <script src="/scripts/utils.js"></script>
    <script src="/scripts/main.js"></script>
    
    <!-- 5. Load iOS header and animation scripts -->
    <script src="/scripts/ios-header.js"></script>
    <script src="/scripts/ios-animations.js"></script>
    
    <!-- 6. Load auth management -->
    <script src="/scripts/auth.js"></script>
    
    <!-- 7. Finally load page-specific scripts -->
    <script src="/scripts/devices.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Hide loading overlay function
            function hideLoadingOverlay() {
                const overlay = document.querySelector('[data-component="loading-overlay"]');
                if (overlay) {
                    overlay.style.opacity = '0';
                    setTimeout(() => {
                        overlay.style.display = 'none';
                    }, 500);
                }
            }
            
            // Show loading overlay function
            function showLoadingOverlay() {
                const overlay = document.querySelector('[data-component="loading-overlay"]');
                if (overlay) {
                    overlay.style.display = 'flex';
                    setTimeout(() => {
                        overlay.style.opacity = '1';
                    }, 10);
                }
            }
            
            // Initialize app object if it doesn't exist
            window.app = window.app || {};
            window.app.showLoading = window.app.showLoading || showLoadingOverlay;
            window.app.hideLoading = window.app.hideLoading || hideLoadingOverlay;
            
            // Show loading overlay initially
            showLoadingOverlay();
            
            // Setup modal functionality
            const addDeviceBtn = document.getElementById('add-device-btn');
            const addDeviceCardBtn = document.getElementById('add-device-card-btn');
            const deviceModal = document.getElementById('device-modal');
            const modalCloseButtons = document.querySelectorAll('.modal-close, [data-dismiss="modal"]');
            
            // Open modal functionality
            [addDeviceBtn, addDeviceCardBtn].forEach(btn => {
                if (btn) {
                    btn.addEventListener('click', () => {
                        deviceModal.classList.add('open');
                    });
                }
            });
            
            // Close modal functionality
            modalCloseButtons.forEach(btn => {
                if (btn) {
                    btn.addEventListener('click', () => {
                        const modal = btn.closest('.ios-modal');
                        if (modal) modal.classList.remove('open');
                    });
                }
            });
            
            // Close modal when clicking outside
            document.querySelectorAll('.ios-modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('open');
                    }
                });
            });
            
            // Setup device detail buttons
            document.querySelectorAll('.view-device-details').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const deviceId = btn.getAttribute('data-device-id');
                    const detailsModal = document.getElementById('device-details-modal');
                    if (detailsModal && deviceId) {
                        detailsModal.classList.add('open');
                        // Set the device ID as a data attribute on the modal
                        detailsModal.setAttribute('data-device-id', deviceId);
                        // Load device details
                        loadDeviceDetails(deviceId);
                    }
                });
            });
            
            // Function to load device details
            function loadDeviceDetails(deviceId) {
                console.log(`Loading details for device ID: ${deviceId}`);
                // This would normally fetch data from your API
                // For now we'll just update based on our existing data
                
                const deviceData = {
                    '1': {
                        name: 'Living Room Feeder',
                        model: 'PetFeeder Pro',
                        serial: 'PFP1001203',
                        firmware: 'v2.1.5',
                        lastUpdate: '2023-04-01',
                        dateAdded: '2023-01-15',
                        status: 'Online',
                        lastFeeding: 'Today, 12:00 PM',
                        nextFeeding: 'Today, 8:00 PM',
                        foodLevel: '72%',
                        battery: '85%',
                        connectionType: 'Wi-Fi',
                        network: 'Home-Network',
                        ip: '192.168.1.105',
                        signal: 'Good (85%)',
                        lastActivity: 'Just now'
                    },
                    '2': {
                        name: 'Kitchen Feeder',
                        model: 'PetFeeder Standard',
                        serial: 'PFS2005109',
                        firmware: 'v2.0.8',
                        lastUpdate: '2023-03-15',
                        dateAdded: '2023-02-10',
                        status: 'Online',
                        lastFeeding: 'Today, 11:30 AM',
                        nextFeeding: 'Today, 7:30 PM',
                        foodLevel: '15%',
                        battery: '62%',
                        connectionType: 'Wi-Fi',
                        network: 'Home-Network',
                        ip: '192.168.1.106',
                        signal: 'Good (78%)',
                        lastActivity: '2 minutes ago'
                    },
                    '3': {
                        name: 'Bedroom Feeder',
                        model: 'PetFeeder Mini',
                        serial: 'PFM3002098',
                        firmware: 'v1.9.3',
                        lastUpdate: '2023-02-28',
                        dateAdded: '2023-03-01',
                        status: 'Offline',
                        lastFeeding: '2 days ago, 6:15 PM',
                        nextFeeding: 'N/A (Offline)',
                        foodLevel: '45%',
                        battery: 'Unknown (Offline)',
                        connectionType: 'Wi-Fi',
                        network: 'Home-Network',
                        ip: 'N/A (Offline)',
                        signal: 'N/A (Offline)',
                        lastActivity: '2 days ago'
                    }
                };
                
                if (deviceData[deviceId]) {
                    const data = deviceData[deviceId];
                    
                    // Update modal title
                    document.getElementById('device-details-name').textContent = data.name;
                    
                    // Update status indicator
                    const statusIndicator = document.querySelector('.device-details-status-indicator');
                    const statusText = document.querySelector('.device-details-status-text');
                    if (data.status === 'Online') {
                        statusIndicator.className = 'device-details-status-indicator online';
                        statusText.textContent = 'Online';
                    } else {
                        statusIndicator.className = 'device-details-status-indicator offline';
                        statusText.textContent = 'Offline';
                    }
                    
                    // Update feed now button
                    const feedNowBtn = document.querySelector('.device-details-actions .feed-now-btn');
                    if (data.status === 'Offline') {
                        feedNowBtn.disabled = true;
                    } else {
                        feedNowBtn.disabled = false;
                    }
                    
                    // Update device info
                    document.getElementById('details-model').textContent = data.model;
                    document.getElementById('details-serial').textContent = data.serial;
                    document.getElementById('details-firmware').textContent = data.firmware;
                    document.getElementById('details-last-update').textContent = data.lastUpdate;
                    document.getElementById('details-date-added').textContent = data.dateAdded;
                    
                    // Update status info
                    document.getElementById('details-status').textContent = data.status;
                    document.getElementById('details-last-feeding').textContent = data.lastFeeding;
                    document.getElementById('details-next-feeding').textContent = data.nextFeeding;
                    document.getElementById('details-food-level').textContent = data.foodLevel;
                    document.getElementById('details-battery').textContent = data.battery;
                    
                    // Update connection info
                    document.getElementById('details-connection-type').textContent = data.connectionType;
                    document.getElementById('details-network').textContent = data.network;
                    document.getElementById('details-ip').textContent = data.ip;
                    document.getElementById('details-signal').textContent = data.signal;
                    document.getElementById('details-last-activity').textContent = data.lastActivity;
                }
            }
            
            // Device status filter
            const deviceStatusFilter = document.getElementById('device-status-filter');
            if (deviceStatusFilter) {
                deviceStatusFilter.addEventListener('change', () => {
                    const filterValue = deviceStatusFilter.value;
                    const deviceCards = document.querySelectorAll('.device-card:not(#add-device-card)');
                    
                    deviceCards.forEach(card => {
                        const deviceStatus = card.getAttribute('data-device-status');
                        if (filterValue === 'all' || filterValue === deviceStatus) {
                            card.style.display = '';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            }
            
            // Setup device tabs
            const tabButtons = document.querySelectorAll('.device-details-tabs .tab-button');
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tab = this.getAttribute('data-tab');
                    
                    // Remove active class from all buttons and tabs
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Add active class to clicked button and corresponding tab
                    this.classList.add('active');
                    document.getElementById(`${tab}-tab`).classList.add('active');
                });
            });
            
            // Setup feeding history chart
            const feedingHistoryChart = document.getElementById('feeding-history-chart');
            if (feedingHistoryChart) {
                new Chart(feedingHistoryChart, {
                    type: 'bar',
                    data: {
                        labels: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'],
                        datasets: [{
                            label: 'Food Dispensed (g)',
                            data: [160, 160, 160, 160, 160, 160, 160],
                            backgroundColor: 'rgba(75, 192, 192, 0.7)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Amount (g)'
                                }
                            }
                        }
                    }
                });
            }
            
            // Hide loading overlay after initialization
            setTimeout(hideLoadingOverlay, 1000);
        });
    </script>
</body>
</html>